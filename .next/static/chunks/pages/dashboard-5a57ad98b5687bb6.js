(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{528:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(6445)}])},6445:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(5893),n=s(7294),l=s(1163),i=s(300);function c(e){let{spent:t,cap:s}=e;if(null===t||null===s)return(0,a.jsx)("div",{className:"text-sm text-text-muted",children:"Data loading..."});if(0===s)return(0,a.jsx)("div",{className:"text-sm text-text-muted",children:"Cap unavailable"});let n=t/s*100,l=n.toFixed(1),i="bg-success-500";return n<70&&(i="bg-warning-500"),n>110&&(i="bg-danger-500"),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-text-primary",children:[l,"%"]}),(0,a.jsxs)("span",{className:"text-xs text-text-muted",children:["$",t.toFixed(2)," / $",s.toFixed(2)]})]}),(0,a.jsx)("div",{className:"w-full bg-border-primary rounded-full h-3 shadow-inner",children:(0,a.jsx)("div",{className:"h-full rounded-full progress-bar-fill shadow-bento ".concat(i),style:{width:"".concat(Math.min(n,100),"%")}})})]})}function r(e){var t,s,l,i,r,d;let{account:o}=e,[x,m]=(0,n.useState)(!1),u=100===o.account_status,h=null===o.spend_today||null===o.daily_limit_display,b=async()=>{try{await navigator.clipboard.writeText(o.account_id),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){console.error("Failed to copy account ID:",e)}};return h?(0,a.jsxs)("div",{className:"bento-tile",children:[(0,a.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,a.jsx)("div",{className:"h-4 bg-border-primary rounded-bento w-3/4"}),(0,a.jsx)("div",{className:"h-4 bg-border-primary rounded-bento w-1/2"}),(0,a.jsx)("div",{className:"h-4 bg-border-primary rounded-bento w-2/3"})]}),(0,a.jsx)("p",{className:"text-center text-text-muted mt-4 animate-fade-in",children:"Data loading..."})]}):(0,a.jsxs)("div",{className:"bento-tile-lg hover-lift ".concat(u?"bg-danger-50 border-danger-200":""),"data-testid":"account-card",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:b,className:"font-mono text-sm font-medium text-text-primary hover:text-primary-600 transition-colors cursor-pointer focus-ring-moss rounded-bento px-2 py-1",title:"Click to copy account ID",children:o.account_id}),x&&(0,a.jsx)("span",{className:"badge badge-success animate-fade-in",children:"✓ Copied!"})]}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary",children:["Vendor: ",(0,a.jsx)("span",{"data-testid":"vendor-name",className:"font-medium text-text-primary",children:o.vendor_name})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"status-indicator ".concat(u?"status-suspended":"status-active"),"data-testid":"status-indicator",children:u?"\uD83D\uDEA8 SUSPENDED":"● ACTIVE"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[!u&&null!==o.spend_today&&null!==o.daily_limit_display&&(0,a.jsxs)("div",{className:"bento-tile p-4 bg-surface-secondary",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-3",children:(0,a.jsxs)("span",{className:"text-sm font-medium text-text-primary","data-testid":"daily-spend",children:["Daily Spend: $",o.spend_today.toFixed(2)," / $",o.daily_limit_display.toFixed(2)," (",o.spend_progress_percent,"%)"]})}),(0,a.jsx)(c,{spent:o.spend_today,cap:o.daily_limit_display})]}),u&&(0,a.jsxs)("div",{className:"bento-tile p-4 bg-danger-50 border-danger-200",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-danger-800",children:["Final Spend: $",(null===(t=o.spend_today)||void 0===t?void 0:t.toFixed(2))||"N/A"," of $",(null===(s=o.daily_limit_display)||void 0===s?void 0:s.toFixed(2))||"N/A"," daily cap"]}),(0,a.jsxs)("p",{className:"text-xs text-danger-600 mt-2",children:["Lifetime Clicks: ",(null===(l=o.outbound_clicks)||void 0===l?void 0:l.toLocaleString())||"N/A"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bento-tile p-3 hover-scale",children:[(0,a.jsx)("div",{className:"text-xs text-text-muted mb-1",children:"Active Ads"}),(0,a.jsxs)("div",{className:"text-lg font-semibold text-text-primary","data-testid":"active-ads",children:[o.active_ads_count||0," / ",o.total_ads_count||0]})]}),(0,a.jsxs)("div",{className:"bento-tile p-3 hover-scale",children:[(0,a.jsx)("div",{className:"text-xs text-text-muted mb-1",children:"Avg CPC"}),(0,a.jsxs)("div",{className:"text-lg font-semibold text-text-primary","data-testid":"avg-cpc",children:["$",(null===(i=o.cpc)||void 0===i?void 0:i.toFixed(2))||"N/A"]})]}),(0,a.jsxs)("div",{className:"bento-tile p-3 hover-scale",children:[(0,a.jsx)("div",{className:"text-xs text-text-muted mb-1",children:"Clicks"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-text-primary","data-testid":"clicks",children:(null===(r=o.outbound_clicks)||void 0===r?void 0:r.toLocaleString())||"N/A"})]}),(0,a.jsxs)("div",{className:"bento-tile p-3 hover-scale",children:[(0,a.jsx)("div",{className:"text-xs text-text-muted mb-1",children:"Balance"}),(0,a.jsxs)("div",{className:"text-lg font-semibold text-text-primary","data-testid":"balance",children:["$",(null===(d=o.account_balance)||void 0===d?void 0:d.toFixed(2))||"N/A"]})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-border-primary flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-xs text-text-muted","data-testid":"last-update",children:["Updated: ",(e=>{let t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4);if(a<1)return"Just now";if(a<60)return"".concat(a," min ago");let n=Math.floor(a/60);if(n<24)return"".concat(n," hour").concat(n>1?"s":""," ago");let l=Math.floor(n/24);return"".concat(l," day").concat(l>1?"s":""," ago")})(o.snapshot_time)]}),!u&&(0,a.jsx)("button",{onClick:b,className:"btn btn-secondary btn-sm",children:"Copy ID"})]})]})}function d(e){let{accounts:t,loading:s=!1,error:l=null,filterSuspended:i}=e,[c,d]=(0,n.useState)(""),[o,x]=(0,n.useState)(!0===i?"suspended":!1===i?"active":"all"),m=(0,n.useMemo)(()=>{let e=t;return"active"===o?e=e.filter(e=>100!==e.account_status):"suspended"===o&&(e=e.filter(e=>100===e.account_status)),c&&(e=e.filter(e=>e.account_id.toLowerCase().includes(c.toLowerCase())||e.vendor_name.toLowerCase().includes(c.toLowerCase()))),e},[t,c,o]),u=(0,n.useMemo)(()=>{let e=t.filter(e=>100!==e.account_status),s=t.filter(e=>100===e.account_status),a=t.reduce((e,t)=>e+(t.spend_today||0),0);return{total:t.length,active:e.length,suspended:s.length,totalSpend:a}},[t]);return s?(0,a.jsx)("div",{className:"min-h-screen bg-background-primary flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bento-tile-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-primary-600 mx-auto mb-6"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Loading accounts..."}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Please wait while we fetch your account data"})]})}):l?(0,a.jsx)("div",{className:"min-h-screen bg-background-primary flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bento-tile-xl p-8 text-center max-w-md",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"⚠️"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-danger-800 mb-2",children:"Error loading accounts"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:l}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Try Again"})]})}):0===t.length?(0,a.jsx)("div",{className:"min-h-screen bg-background-primary flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bento-tile-xl p-8 text-center max-w-md",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCCA"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"No accounts found"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:"Get started by adding your first Facebook ad account"}),(0,a.jsx)("button",{className:"btn btn-primary",children:"Add Account"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-background-primary",children:[(0,a.jsxs)("div",{className:"bento-tile-lg m-6 p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:"Account Dashboard"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Monitor your Facebook ad accounts in real-time"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-4 lg:mt-0",children:[(0,a.jsxs)("div",{className:"bento-tile p-4 text-center hover-scale",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-text-primary",children:u.total}),(0,a.jsx)("div",{className:"text-sm text-text-muted",children:"Total Accounts"})]}),(0,a.jsxs)("div",{className:"bento-tile p-4 text-center hover-scale",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-success-600",children:u.active}),(0,a.jsx)("div",{className:"text-sm text-text-muted",children:"Active"})]}),(0,a.jsxs)("div",{className:"bento-tile p-4 text-center hover-scale",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-danger-600",children:u.suspended}),(0,a.jsx)("div",{className:"text-sm text-text-muted",children:"Suspended"})]}),(0,a.jsxs)("div",{className:"bento-tile p-4 text-center hover-scale",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-primary-600",children:["$",u.totalSpend.toFixed(2)]}),(0,a.jsx)("div",{className:"text-sm text-text-muted",children:"Total Daily Spend"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",placeholder:"Search accounts...",value:c,onChange:e=>d(e.target.value),className:"input","data-testid":"search-input"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>x("all"),className:"btn btn-sm ".concat("all"===o?"btn-primary":"btn-secondary"),children:"All"}),(0,a.jsx)("button",{onClick:()=>x("active"),className:"btn btn-sm ".concat("active"===o?"btn-primary":"btn-secondary"),children:"Active"}),(0,a.jsx)("button",{onClick:()=>x("suspended"),className:"btn btn-sm ".concat("suspended"===o?"btn-primary":"btn-secondary"),children:"Suspended"})]})]})]}),(0,a.jsx)("div",{className:"bento-grid m-6","data-testid":"dashboard-grid",children:m.map(e=>(0,a.jsx)(r,{account:e},e.account_id))}),0===m.length&&(0,a.jsxs)("div",{className:"bento-tile-lg m-6 p-8 text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-text-primary mb-2",children:"No accounts found"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Try adjusting your search terms or filters"})]})]})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),m=(e,t)=>{let s=(0,n.forwardRef)(({color:s="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:c="",children:r,...d},m)=>(0,n.createElement)("svg",{ref:m,...o,width:a,height:a,stroke:s,strokeWidth:i?24*Number(l)/Number(a):l,className:["lucide",`lucide-${x(e)}`,c].join(" "),...d},[...t.map(([e,t])=>(0,n.createElement)(e,t)),...Array.isArray(r)?r:[r]]));return s.displayName=`${e}`,s},u=m("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),h=m("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),b=m("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),p=m("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),v=m("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function j(e){let{id:t,type:s,message:l,duration:i=5e3,onClose:c}=e,[r,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{setTimeout(()=>d(!0),10);let e=setTimeout(()=>{o()},i);return()=>clearTimeout(e)},[i]);let o=()=>{d(!1),setTimeout(()=>c(t),300)},x={success:(0,a.jsx)(u,{className:"w-5 h-5"}),error:(0,a.jsx)(h,{className:"w-5 h-5"}),warning:(0,a.jsx)(b,{className:"w-5 h-5"}),info:(0,a.jsx)(p,{className:"w-5 h-5"})};return(0,a.jsxs)("div",{className:"\n        toast-notification\n        ".concat(r?"toast-enter":"toast-exit","\n        ").concat({success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-amber-50 border-amber-200 text-amber-800",info:"bg-blue-50 border-blue-200 text-blue-800"}[s],"\n        flex items-start gap-3 p-4 rounded-lg border-2 shadow-lg\n        max-w-md w-full\n      "),role:"alert",children:[(0,a.jsx)("div",{className:{success:"text-green-600",error:"text-red-600",warning:"text-amber-600",info:"text-blue-600"}[s],children:x[s]}),(0,a.jsx)("p",{className:"flex-1 text-sm font-medium",children:l}),(0,a.jsx)("button",{onClick:o,className:"text-current opacity-60 hover:opacity-100 transition-opacity","aria-label":"Close notification",children:(0,a.jsx)(v,{className:"w-4 h-4"})})]})}function f(e){let{toasts:t,onClose:s}=e;return(0,a.jsx)("div",{className:"toast-container fixed top-4 right-4 z-50 flex flex-col gap-2",children:t.map(e=>(0,a.jsx)(j,{...e,onClose:s},e.id))})}function N(){var e;let{user:t,loading:s,signOut:c}=(0,i.d)(),r=(0,l.useRouter)(),[o,x]=(0,n.useState)([]),[m,u]=(0,n.useState)(!0),[h,b]=(0,n.useState)(null),{toasts:p,showWarning:v,showError:j,removeToast:N}=function(){let[e,t]=(0,n.useState)([]),s=(e,s,a)=>{let n="toast-".concat(Date.now(),"-").concat(Math.random());t(t=>[...t,{id:n,type:e,message:s,duration:a}])};return{toasts:e,showSuccess:(e,t)=>s("success",e,t),showError:(e,t)=>s("error",e,t),showWarning:(e,t)=>s("warning",e,t),showInfo:(e,t)=>s("info",e,t),removeToast:e=>{t(t=>t.filter(t=>t.id!==e))}}}(),[y,g]=(0,n.useState)(new Set);(0,n.useEffect)(()=>{s||t||r.push("/login")},[t,s,r]),(0,n.useEffect)(()=>{if(t){w();let e=setInterval(w,3e4);return()=>clearInterval(e)}},[t]);let w=async()=>{try{u(!0),b(null);let e=await fetch("/api/get-accounts"),t=await e.json();if(t.success){let e=t.accounts||[];e.forEach(e=>{100!==e.account_status||y.has(e.account_id)||(v("Account ".concat(e.vendor_name," (").concat(e.account_id,") has been suspended!"),8e3),g(t=>new Set(t).add(e.account_id)))}),x(e)}else{let e=t.message||"Failed to fetch accounts";b(e),j(e,5e3)}}catch(t){console.error("Error fetching accounts:",t);let e="Failed to load account data";b(e),j(e,5e3)}finally{u(!1)}};return s?(0,a.jsx)("div",{className:"min-h-screen bg-background-primary flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bento-tile-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-primary-600 mx-auto mb-6"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Loading Dashboard"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Please wait while we authenticate..."})]})}):t?(0,a.jsxs)("div",{className:"min-h-screen bg-background-primary",children:[(0,a.jsx)(f,{toasts:p,onClose:N}),(0,a.jsx)("div",{className:"bento-tile-lg m-6 p-6",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary mb-2",children:"Account Dashboard"}),(0,a.jsxs)("p",{className:"text-text-secondary",children:["Welcome back, ",(null==t?void 0:t.name)||"User","!"]})]}),(0,a.jsxs)("div",{className:"bento-tile p-4 bg-surface-secondary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary-600",children:null==t?void 0:null===(e=t.username)||void 0===e?void 0:e.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-text-primary font-medium",children:(null==t?void 0:t.name)||"User"}),(0,a.jsx)("div",{className:"text-xs text-text-muted capitalize",children:(null==t?void 0:t.role)||"viewer"})]})]}),(0,a.jsx)("button",{onClick:()=>{c(),r.push("/login")},className:"btn btn-secondary btn-sm mt-3 w-full",children:"Sign Out"})]})]})}),(0,a.jsx)(d,{accounts:o,loading:m,error:h})]}):(0,a.jsx)("div",{className:"min-h-screen bg-background-primary flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bento-tile-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDD12"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:"Please sign in to view your dashboard"}),(0,a.jsx)("button",{onClick:()=>r.push("/login"),className:"btn btn-primary",children:"Go to Login"})]})})}},1163:function(e,t,s){e.exports=s(2937)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=528)}),_N_E=e.O()}]);